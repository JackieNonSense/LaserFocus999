# Faster R-CNN with ResNet-50 FPN backbone
# Configuration for AgroPest-12 Insect Detection

MODEL:
  WEIGHTS: "detectron2://COCO-Detection/faster_rcnn_R_50_FPN_3x/137849458/model_final_280758.pkl"
  ROI_HEADS:
    NUM_CLASSES: 12  # AgroPest-12 has 12 insect classes
    BATCH_SIZE_PER_IMAGE: 512
    SCORE_THRESH_TEST: 0.5

  # Backbone freezing (optional, uncomment to freeze early layers)
  # BACKBONE:
  #   FREEZE_AT: 2  # Freeze res2 layer

DATASETS:
  TRAIN: ("agropest_train",)
  TEST: ("agropest_valid",)

DATALOADER:
  NUM_WORKERS: 4
  # Sampler
  SAMPLER_TRAIN: "TrainingSampler"

SOLVER:
  # Batch size
  IMS_PER_BATCH: 4  # Adjust based on GPU memory
  BASE_LR: 0.001  # Lower than default for fine-tuning

  # Learning rate schedule
  STEPS: (15000, 20000)  # Decay LR at these iterations
  MAX_ITER: 25000  # Total training iterations
  GAMMA: 0.1  # LR decay factor

  # Warmup
  WARMUP_FACTOR: 0.001
  WARMUP_ITERS: 1000
  WARMUP_METHOD: "linear"

  # Optimizer
  OPTIMIZER: "SGD"
  MOMENTUM: 0.9
  WEIGHT_DECAY: 0.0001

  # Checkpointing
  CHECKPOINT_PERIOD: 2500

INPUT:
  # Image size during training
  MIN_SIZE_TRAIN: (640, 672, 704, 736, 768, 800)
  MAX_SIZE_TRAIN: 1333

  # Image size during testing
  MIN_SIZE_TEST: 800
  MAX_SIZE_TEST: 1333

  # Data augmentation
  RANDOM_FLIP: "horizontal"

TEST:
  EVAL_PERIOD: 2500  # Evaluate every N iterations
  DETECTIONS_PER_IMAGE: 100

OUTPUT_DIR: "./outputs/checkpoints/faster_rcnn_R50_FPN"

# Random seed for reproducibility
SEED: 42
